{% extends "base.html" %}

{% block content %}

{% if page.is_homepage %}

<h2>üöÄ Neueste Beitr√§ge</h2>

{% set recent_pages = [] %}

{# --- Robuste und sichere Navigation --- #}
{% for p in nav.walk_pages() %}

    {% if p.is_page and p.meta is defined %}

        {# 1. Priorit√§t: revision_date #}
        {% if p.meta.revision_date is defined %}
            {% set recent_pages = recent_pages + [p] %}

        {# 2. Fallback: git-revision-date-localized plugin #}
        {% elif p.meta.git_revision_date_localized is defined %}
            {% set recent_pages = recent_pages + [p] %}
        {% endif %}

    {% endif %}
{% endfor %}

{# Sortierung: zuerst revision_date, dann git-fallback #}
{% set sorted_pages = recent_pages
    | sort(attribute="meta.revision_date", reverse=True, default="1970-01-01")
    | sort(attribute="meta.git_revision_date_localized", reverse=True, default="1970-01-01")
%}

<ul>
{% for p in sorted_pages | slice(3) %}
    <li>
        <a href="{{ p.url | url }}">{{ p.title }}</a>
        <small>
            (
            {% if p.meta.revision_date is defined %}
                zuletzt ge√§ndert: {{ p.meta.revision_date.strftime('%Y-%m-%d') }}
            {% elif p.meta.git_revision_date_localized is defined %}
                zuletzt ge√§ndert: {{ p.meta.git_revision_date_localized }}
            {% else %}
                kein Datum
            {% endif %}
            )
        </small>
    </li>
{% endfor %}
</ul>

<hr>

{% endif %}

{# Standard-Content von Material (TOC, Text etc.) #}
{{ super() }}

{% endblock %}



{# ------------------------------------------------------- #}
{#            FOOTER MIT GISCUS (Kommentare)               #}
{# ------------------------------------------------------- #}

{% block content_article_footer %}

<hr>

<script src="https://giscus.app/client.js"
        data-repo="umbassa-long/wiki-code"
        data-repo-id="R_kgDOP3PyJA"
        data-category="Neuigkeiten"
        data-category-id="DIC_kwDOP3PyJM4Cx8D4"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="de"
        crossorigin="anonymous"
        async>
</script>

{% endblock %}
