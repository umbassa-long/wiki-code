{% extends "base.html" %}

{% block content %}

{% if page.is_homepage %}
    <h2>ğŸš€ Neueste BeitrÃ¤ge</h2>
    
    {% set recent_pages = [] %}
    
    {# 1. Sicher durch die nav.pages iterieren, um nur echte Seitenobjekte zu sammeln #}
    {% for item in nav.pages %}
      
      {# PrÃ¼fen, ob das Objekt eine Seite ist #}
      {% if item.is_page is defined and item.is_page %}
        
        {# Jetzt prÃ¼fen wir sicher, ob die vom Plugin bereitgestellten Metadaten existieren #}
        {% if item.meta.revision_date is defined %}
          {# Nur wenn beide Bedingungen erfÃ¼llt sind, fÃ¼gen wir die Seite hinzu #}
          {% set recent_pages = recent_pages + [item] %}
        {% endif %}
        
      {% endif %}
    {% endfor %} <-- HIER FEHLTE DAS ENDFOR!

    {# 2. Sortieren und Ausgabe der letzten 3 EintrÃ¤ge #}
    <ul>
      {% for item in recent_pages | sort(attribute='meta.revision_date', reverse=True) | slice(3) %}
        <li>
          <a href="{{ item.url | url }}">{{ item.title }}</a>
          <small> (zuletzt geÃ¤ndert: {{ item.meta.revision_date.strftime('%Y-%m-%d') }})</small>
        </li>
      {% endfor %}
    </ul>
    <hr>
{% endif %} <-- SchlieÃŸt die homepage-PrÃ¼fung

{# HIER beginnt Ihr ursprÃ¼nglicher Giscus-Block #}
{{ super() }}

{% block content.article.footer %} 
    <hr>
    
    <script src="https://giscus.app/client.js"
            data-repo="umbassa-long/wiki-code"
            data-repo-id="R_kgDOP3PyJA"
            data-category="Neuigkeiten"
            data-category-id="DIC_kwDOP3PyJM4Cx8D4"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="1"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-lang="de"
            crossorigin="anonymous"
            async>
    </script>
    
{% endblock %}
{% endblock %}