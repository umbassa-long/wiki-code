{% extends "base.html" %}

{% block content %}

{{% if page.is_homepage %}

<h2>ðŸš€ Neueste BeitrÃ¤ge</h2>

{% set recent_pages = [] %}

{# Navigation vollstÃ¤ndig durchlaufen â€” auch verschachtelte Sektionen #}
{% for p in nav.walk_pages() %}

    {# Nur echte Seiten #}
    {% if p.is_page %}

        {# PrÃ¼fung auf vorhandene Metadaten #}
        {% if p.meta is defined %}

            {# Wenn revision_date existiert â†’ verwenden #}
            {% if p.meta.revision_date is defined %}
                {% set recent_pages = recent_pages + [p] %}

            {# Falls nicht, aber git-revision-date-localized aktiv ist â†’ Fallback #}
            {% elif p.meta.git_revision_date_localized is defined %}
                {% set recent_pages = recent_pages + [p] %}
            {% endif %}

        {% endif %}
    {% endif %}

{% endfor %}

{# Sortieren: Zuerst revision_date, sonst git_revision_date_localized #}
{% set sorted_pages = recent_pages
    | sort(attribute='meta.revision_date', reverse=True, default='1970-01-01')
    | sort(attribute='meta.git_revision_date_localized', reverse=True, default='1970-01-01')
%}

<ul>
{% for p in sorted_pages | slice(3) %}
    <li>
        <a href="{{ p.url | url }}">{{ p.title }}</a>

        <small>
        (
        {% if p.meta.revision_date is defined %}
            zuletzt geÃ¤ndert: {{ p.meta.revision_date.strftime('%Y-%m-%d') }}
        {% elif p.meta.git_revision_date_localized is defined %}
            zuletzt geÃ¤ndert: {{ p.meta.git_revision_date_localized }}
        {% else %}
            kein Datum
        {% endif %}
        )
        </small>
    </li>
{% endfor %}
</ul>

<hr>

{% endif %}


{# HIER beginnt Ihr ursprÃ¼nglicher Giscus-Block #}
{{ super() }}

{% block content_article_footer %} 
    <hr>
    
    <script src="https://giscus.app/client.js"
            data-repo="umbassa-long/wiki-code"
            data-repo-id="R_kgDOP3PyJA"
            data-category="Neuigkeiten"
            data-category-id="DIC_kwDOP3PyJM4Cx8D4"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="1"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-lang="de"
            crossorigin="anonymous"
            async>
    </script>
    
{% endblock %}
{% endblock %}