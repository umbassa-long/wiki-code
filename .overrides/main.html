{% extends "base.html" %}

{% block content %}

{% if page.is_homepage %}

<h2>üöÄ Neueste Beitr√§ge</h2>

{% set recent_pages = [] %}

{# --- Robuste und sichere Navigation --- #}

{# Wir nutzen 'namespace', damit die Variable auch au√üerhalb der Schleife verf√ºgbar bleibt #}
{% set ns = namespace(recent_pages=[]) %}

{# 'pages' ist die globale Variable von MkDocs, die alle Seiten enth√§lt #}
{% for p in pages %}

    {# Pr√ºfen, ob Meta-Daten vorhanden sind #}
    {% if p.meta is defined %}

        {# 1. Priorit√§t: revision_date #}
        {% if p.meta.revision_date is defined %}
            {% set ns.recent_pages = ns.recent_pages + [p] %}

        {# 2. Fallback: git-revision-date-localized plugin #}
        {# Wir f√ºgen es nur hinzu, wenn es nicht schon durch revision_date hinzugef√ºgt wurde, 
           um Duplikate zu vermeiden (optional, je nach Logik) #}
        {% elif p.meta.git_revision_date_localized is defined %}
            {% set ns.recent_pages = ns.recent_pages + [p] %}
        {% endif %}

    {% endif %}
{% endfor %}

{# Sortierung: Zugriff nun √ºber ns.recent_pages #}
{% set sorted_pages = ns.recent_pages
    | sort(attribute="meta.revision_date", reverse=True)
    | sort(attribute="meta.git_revision_date_localized", reverse=True)
%}

<ul>
{% for p in sorted_pages | slice(3) %}
    <li>
        <a href="{{ p.url | url }}">{{ p.title }}</a>
        <small>
            (
            {% if p.meta.revision_date is defined %}
                {# Beachte: revision_date ist oft ein Datum-Objekt, git_revision... ein String #}
                zuletzt ge√§ndert: {{ p.meta.revision_date }}
            {% elif p.meta.git_revision_date_localized is defined %}
                zuletzt ge√§ndert: {{ p.meta.git_revision_date_localized }}
            {% else %}
                kein Datum
            {% endif %}
            )
        </small>
    </li>
{% endfor %}
</ul>

<hr>

{% endif %}

{# Standard-Content von Material (TOC, Text etc.) #}
{{ super() }}

{% endblock %}



{# ------------------------------------------------------- #}
{#            FOOTER MIT GISCUS (Kommentare)               #}
{# ------------------------------------------------------- #}

{% block content_article_footer %}

<hr>

<script src="https://giscus.app/client.js"
        data-repo="umbassa-long/wiki-code"
        data-repo-id="R_kgDOP3PyJA"
        data-category="Neuigkeiten"
        data-category-id="DIC_kwDOP3PyJM4Cx8D4"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="de"
        crossorigin="anonymous"
        async>
</script>

{% endblock %}
